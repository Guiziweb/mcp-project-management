{% set form = this.formView %}

<div {{ attributes }}>
    {{ form_start(form, {action: path('oauth_google_callback'), method: 'POST', attr: {class: 'space-y-5'}}) }}

    <!-- Provider selector -->
    <div class="grid grid-cols-2 gap-3">
        {% for child in form.provider %}
            <label class="cursor-pointer">
                {{ form_widget(child, {
                    attr: {
                        'data-model': 'selectedProvider',
                        'data-action': 'change->live#update',
                        'class': 'peer sr-only'
                    }
                }) }}
                <div class="flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all
                    {% if child.vars.value == selectedProvider %}
                        border-indigo-500 bg-indigo-500/10
                    {% else %}
                        border-slate-600 hover:border-slate-500
                    {% endif %}
                ">
                    {% if child.vars.value == 'redmine' %}
                        <svg viewBox="0 0 100 100" class="w-8 h-8">
                            <polygon points="50,5 95,50 50,95 5,50" fill="#B32024"/>
                            <polygon points="50,15 85,50 50,85 15,50" fill="#9C1B1F"/>
                            <text x="50" y="58" text-anchor="middle" fill="white" font-size="28" font-weight="bold" font-family="Arial">R</text>
                        </svg>
                    {% elseif child.vars.value == 'jira' %}
                        <svg viewBox="0 0 100 100" class="w-8 h-8">
                            <path d="M90,50 L50,90 L30,70 L50,50 L30,30 L50,10 L90,50 Z" fill="#2684FF"/>
                            <path d="M50,50 L30,70 L10,50 L30,30 L50,50 Z" fill="#2684FF" opacity="0.6"/>
                        </svg>
                    {% endif %}
                    <span class="text-sm font-medium text-slate-200">{{ child.vars.label }}</span>
                </div>
            </label>
        {% endfor %}
    </div>

    <!-- Credential fields -->
    {% for child in form %}
        {% if child.vars.name not in ['provider', 'submit', '_token'] %}
            <div>
                <label for="{{ child.vars.id }}" class="block text-sm font-medium text-slate-300 mb-1">
                    {{ child.vars.label }}
                </label>
                {{ form_widget(child, {
                    attr: {
                        class: 'w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                    }
                }) }}
                {% if child.vars.help %}
                    <p class="mt-1 text-xs text-slate-500">{{ child.vars.help }}</p>
                {% endif %}
                {% for error in child.vars.errors %}
                    <p class="mt-1 text-sm text-red-400">{{ error.message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endfor %}

    <!-- Submit -->
    <button type="submit" data-live-ignore class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white font-medium rounded-lg transition-colors">
        Connect
    </button>

    {{ form_end(form, {render_rest: false}) }}
</div>