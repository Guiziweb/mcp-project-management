{# Provider step with visual cards #}
{% set cards = form.vars.provider_cards %}

<div class="space-y-6">
    {# Provider Cards #}
    {{ form_errors(form.providerType) }}
    <div class="grid gap-3">
        {% for child in form.providerType %}
            {% set providerKey = child.vars.value %}
            {% set card = cards[providerKey] ?? null %}
            <label class="provider-card relative flex items-center gap-4 p-4 bg-neutral-900 border border-neutral-700 rounded-lg cursor-pointer transition-all hover:border-neutral-500 has-[:checked]:border-white has-[:checked]:bg-neutral-800">
                {{ form_widget(child, {attr: {class: 'sr-only'}}) }}

                {# Icon #}
                <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-neutral-800 flex items-center justify-center">
                    {% if providerKey == 'redmine' %}
                        <svg class="w-5 h-5 text-red-400" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                    {% elseif providerKey == 'jira' %}
                        <svg class="w-5 h-5 text-blue-400" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.004 0L2.315 9.689h5.91L12 5.914l3.775 3.775h5.91L12.004 0zm0 9.689L8.225 13.464 12 17.24l3.775-3.775L12.004 9.69zm0 7.551l-3.775-3.775H2.315L12 23.154l9.685-9.689h-5.91l-3.771 3.775z"/>
                        </svg>
                    {% elseif providerKey == 'monday' %}
                        <svg class="w-5 h-5 text-yellow-400" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="3" y="3" width="18" height="18" rx="3"/>
                        </svg>
                    {% endif %}
                </div>

                {# Content #}
                <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-100">{{ card.label ?? child.vars.label }}</div>
                    {% if card.description is defined %}
                        <div class="text-sm text-neutral-500 truncate">{{ card.description }}</div>
                    {% endif %}
                </div>

                {# Check indicator #}
                <div class="flex-shrink-0 w-5 h-5 rounded-full border-2 border-neutral-600 flex items-center justify-center transition-colors peer-checked:border-white peer-checked:bg-white check-indicator">
                    <svg class="w-3 h-3 text-neutral-900 opacity-0 check-icon" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                    </svg>
                </div>
            </label>
        {% endfor %}
    </div>

    {# URL Field (shown/hidden based on provider) #}
    <div id="provider-url-container" class="hidden">
        {{ form_label(form.providerUrl, null, {label_attr: {class: 'block text-sm font-medium text-neutral-300 mb-2'}}) }}
        {{ form_widget(form.providerUrl) }}
        {{ form_errors(form.providerUrl) }}
    </div>
</div>

<style>
    .provider-card:has(input:checked) .check-indicator {
        border-color: white;
        background-color: white;
    }
    .provider-card:has(input:checked) .check-icon {
        opacity: 1;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cards = {{ cards|json_encode|raw }};
    const urlContainer = document.getElementById('provider-url-container');
    const urlInput = urlContainer?.querySelector('input');
    const radios = document.querySelectorAll('.provider-card input[type="radio"]');

    function updateUrlField() {
        const selected = document.querySelector('.provider-card input[type="radio"]:checked');
        if (!selected || !urlContainer) return;

        const providerKey = selected.value;
        const card = cards[providerKey];

        if (card && card.requiresUrl) {
            urlContainer.classList.remove('hidden');
            if (urlInput) {
                urlInput.placeholder = card.urlPlaceholder || 'https://...';
            }
        } else {
            urlContainer.classList.add('hidden');
            if (urlInput) {
                urlInput.value = '';
            }
        }
    }

    radios.forEach(radio => {
        radio.addEventListener('change', updateUrlField);
    });

    // Initial state
    updateUrlField();
});
</script>
