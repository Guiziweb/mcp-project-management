{% set form = this.formView %}

<div {{ attributes }}>
    {{ form_start(form, {
        attr: {
            'class': 'space-y-8',
            'data-action': 'live#action:prevent',
            'data-live-action-param': 'save'
        }
    }) }}

    <!-- Provider selector -->
    <div>
        <label class="block text-sm font-medium text-neutral-400 mb-4">Platform</label>
        <div class="grid grid-cols-3 gap-3">
            {% for child in form.provider %}
                <label class="cursor-pointer">
                    {{ form_widget(child, {
                        attr: {
                            'data-model': 'on(change)|selectedProvider',
                            'class': 'peer sr-only'
                        }
                    }) }}
                    <div class="flex flex-col items-center gap-3 py-5 px-4 rounded-xl border transition-colors
                        {% if child.vars.value == selectedProvider %}
                            border-white bg-white/5
                        {% else %}
                            border-neutral-800 hover:border-neutral-700
                        {% endif %}
                    ">
                        {% if child.vars.value == 'redmine' %}
                            <svg viewBox="0 0 24 24" class="w-8 h-8">
                                <path d="M12 2L22 12L12 22L2 12L12 2Z" fill="#B32024"/>
                                <text x="12" y="15" text-anchor="middle" fill="white" font-size="8" font-weight="bold" font-family="Arial">R</text>
                            </svg>
                        {% elseif child.vars.value == 'jira' %}
                            <svg viewBox="0 0 24 24" class="w-8 h-8">
                                <path d="M20 12L12 20L9 17L14 12L9 7L12 4L20 12Z" fill="#2684FF"/>
                                <path d="M12 12L9 15L4 12L9 9L12 12Z" fill="#2684FF" opacity="0.6"/>
                            </svg>
                        {% elseif child.vars.value == 'monday' %}
                            <svg viewBox="0 0 24 24" class="w-8 h-8">
                                <circle cx="8" cy="12" r="3" fill="#FF3D57"/>
                                <circle cx="16" cy="12" r="3" fill="#00CA72"/>
                            </svg>
                        {% endif %}
                        <span class="text-sm font-medium {% if child.vars.value == selectedProvider %}text-white{% else %}text-neutral-500{% endif %}">
                            {{ child.vars.label }}
                        </span>
                    </div>
                </label>
            {% endfor %}
        </div>
    </div>

    <!-- Credential fields -->
    <div class="space-y-5">
        {% for child in form %}
            {% if child.vars.name not in ['provider', 'submit', '_token'] %}
                <div>
                    <label for="{{ child.vars.id }}" class="block text-sm font-medium text-neutral-400 mb-2">
                        {{ child.vars.label }}
                    </label>
                    {{ form_widget(child, {
                        attr: {
                            class: 'w-full px-4 py-3 bg-transparent border border-neutral-800 rounded-xl text-white placeholder-neutral-600 focus:outline-none focus:border-neutral-600 transition-colors'
                        }
                    }) }}
                    {% if child.vars.help %}
                        <p class="mt-2 text-xs text-neutral-600">{{ child.vars.help }}</p>
                    {% endif %}
                    {% for error in child.vars.errors %}
                        <p class="mt-2 text-sm text-red-400">{{ error.message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <!-- Submit -->
    <button type="submit" data-live-ignore class="w-full py-3 bg-white text-neutral-900 font-medium rounded-xl hover:bg-neutral-200 transition-colors">
        Connect
    </button>

    {{ form_end(form, {render_rest: false}) }}
</div>